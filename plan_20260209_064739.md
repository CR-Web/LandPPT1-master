**排查结论**
用户反馈的“模板样式不一致”问题（特别是预览时背景丢失），根源在于：

1. **前端预览数据源缺失**：Mapping 预览界面是基于 `slot_mappings` 绘制的，而 `TemplateParser` 之前只提取了文本槽位（Slots），**完全忽略了背景图片、颜色和装饰性形状**。
2. **渲染逻辑未闭环**：虽然导入 API 生成了包含完整样式的 HTML (`html_template`)，但前端在 Mapping 阶段并没有利用这个 HTML 作为底图，而是自己在空白画布上画了几个框。

**修复方案**
我们将采用“**基于生成 HTML 的背景提取**”策略，利用现有的高质量 PPT-to-HTML 转换逻辑，提取去除槽位后的“纯净背景”，并在前端预览时垫底。

**Step 1: 后端逻辑增强 (src/landppt/api/global\_master\_template\_api.py)**

* **新增** **`_extract_layout_backgrounds(html_template)`** **函数**：

  * 解析生成的完整 HTML。

  * 遍历每个 Slide (`div.slide`)。

  * 对于每个 Slide，**克隆**一份副本。

  * 在副本中，**移除**所有包含 `{{` 和 `}}` (即槽位占位符) 的 DOM 元素。

  * 保留剩下的所有元素（背景图、装饰形状、线条、Logo 等）。

  * 将清洗后的 HTML 片段作为 `background_html`。

* **更新** **`import_ppt_as_template`** **接口**：

  * 在生成 `html_template` 后，调用上述提取函数。

  * 将提取到的 `background_html` 映射表存入 `style_config['layouts']` 中（Key 为 layout 名称或 slide index）。

**Step 2: 前端预览渲染 (src/landppt/web/templates/project\_detail.html)**

* **更新** **`renderMappingPreviewSlots`** **函数**：

  * 在绘制 Slots 之前，先检查当前 Layout 是否有 `background_html`。

  * 如果有，创建一个绝对定位的底层容器 (`z-index: 0`)，将 `background_html` 注入其中。

  * 原有的 Slots 绘制逻辑保持不变，但确保 `z-index` 高于背景层，实现“背景+槽位”的完美叠加预览。

**验证方法**

1. 重新导入一个带有复杂背景的 PPT 模板。
2. 进入项目详情页，打开 Mapping 预览。
3. 确认预览界面不再是白底，而是显示了原 PPT 的背景和装饰，且槽位框正确覆盖在对应位置。

